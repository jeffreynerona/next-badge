{"version":3,"sources":["../../src/controller/event.js"],"names":["config","db","api","post","req","res","next","newEvent","name","body","description","category","location","starttime","Date","endtime","image","owner","user","id","save","err","status","json","success","message","get","find","events","findById","params","event","put","error","delete","remove","newAttend","_id"],"mappings":"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","file":"event.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Event from '../model/event';\nimport Attend from '../model/attend';\n\nimport { authenticate } from '../middleware/authMiddleware';\n\nexport default({ config, db }) => {\n\tlet api = Router();\n\n\t// 'v1/event/add'\n\tapi.post('/add', authenticate, (req, res, next) => {\n\t\tlet newEvent = new Event();\n\t\tnewEvent.name = req.body.name;\n\t\tnewEvent.description = req.body.description;\n\t\tnewEvent.category = req.body.category;\n\t\tnewEvent.location = req.body.location;\n\t\tnewEvent.starttime = new Date(req.body.starttime);\n\t\tnewEvent.endtime = new Date(req.body.endtime);\n\t\tnewEvent.image = req.body.image;\n\t\tnewEvent.owner = req.user.id;\n\t\tnewEvent.save(err => {\n\t\t\tif (err) {\n\t\t\t\tres.status(422).json({\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: err.message\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tres.status(200).json({\n\t\t\t\t\tsuccess: true,\n\t\t\t\t\tmessage: 'Event saved successfully'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\n\t// '/v1/event/' - read\n\tapi.get('/', (req,res) => {\n\t\tEvent.find({}, (err, events) => {\n\t\t\tif (err) {\n\t\t\t\tres.status(422).json({\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: err.message\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tres.status(200).json(events);\n\t\t\t}\n\t\t});\n\t});\n\n\t// '/v1/event/:id' - read 1\n\tapi.get('/:id', (req, res) => {\n\t\tEvent.findById(req.params.id, (err, event) => {\n\t\t\tif (err) {\n\t\t\t\tres.status(422).json({\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: err.message\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tres.status(200).json(event);\n\t\t\t}\n\t\t});\n\t});\n\n\t// '/v1/event/:id' - update 1\n\tapi.put('/:id', authenticate, (req,res) => {\n\t\tEvent.findById(req.params.id, (err, event) => {\n\t\t\tif (err) {\n\t\t\t\tres.status(422).json({\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: err.message\n\t\t\t\t});\n\t\t\t} else if (!event){\n\t\t\t\t\treturn res.status(404).json({\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'Not Found.'\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t\tif (req.user.id == event.owner) {\n\t\t\t\t\tevent.name = req.body.name;\n\t\t\t\t\tevent.description = req.body.description;\n\t\t\t\t\tevent.category = req.body.category;\n\t\t\t\t\tevent.location = req.body.location;\n\t\t\t\t\tevent.starttime = new Date(req.body.starttime);\n\t\t\t\t\tevent.endtime = new Date(req.body.endtime);\n\t\t\t\t\tevent.image = req.body.image;\n\t\t\t\t\tevent.save(err => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tres.status(422).json({\n\t\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\t\tmessage: err.message\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres.status(200).json({\n\t\t\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\t\t\tmessage: \"Event info updated\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn res.status(401).json({\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'Not Authorized.'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\t// '/v1/event/:id' - delete\n\tapi.delete(\"/:id\", authenticate, (req, res) => {\n\t\tEvent.findById(req.params.id, (err, event) => {\n\t\t\tif (err) {\n\t\t\t\tres.status(422).json({\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: err.message\n\t\t\t\t});\n\t\t\t} else if (!event){\n\t\t\t\t\treturn res.status(404).json({\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'Not Found.'\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t\tif (req.user.id == event.owner) {\n\t\t\t\t\tevent.name = req.body.name;\n\t\t\t\t\tevent.remove(err => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tres.status(422).json({\n\t\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\t\tmessage: err.message\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres.status(200).json({\n\t\t\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\t\t\tmessage: \"Event deleted\"\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturn res.status(401).json({\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'Not Authorized.'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\t// '/v1/event/add/:id attend\n\tapi.post('/add/:id', authenticate, (req,res) => {\n\t\tEvent.findById(req.params.id, (err, event) => {\n\t\t\tif (err) {\n\t\t\t\tres.status(422).json({\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: err.message\n\t\t\t\t});\n\t\t\t} else if (!event){\n\t\t\t\t\treturn res.status(404).json({\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'Not Found.'\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet newAttend = new Attend();\n\n\t\t\t\tnewAttend.user = req.user.id;\n\t\t\t\tnewAttend.event = event._id;\n\t\t\t\tnewAttend.save((err, event) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tres.status(422).json({\n\t\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\t\tmessage: err.message\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tres.status(200).json({\n\t\t\t\t\t\tmessage: 'Attendee Saved!'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\n\treturn api;\n}"]}